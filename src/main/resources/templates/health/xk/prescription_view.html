<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<title>昆山健康宣教系统</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<style type="text/css">
td {
    vertical-align: middle;
    text-align: center;
    padding: 5px;
    border: 1px solid #ddd;
    line-height: 1.42857143;
}

table {
    width: 1070px;
    border-spacing: 0;
    border-collapse: collapse;
    margin-bottom: 0;
}

pre {
    white-space: pre-wrap;
    word-wrap: break-word;
}

body {
    padding: 2px;
    font: 400 13.3333px Arial;
    text-size-adjust: 100%;
    word-wrap: break-word;
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
}

@page {
    size: auto;
    margin: 0mm;
}

.container1 {
    width: 1070px;
    margin: 0 auto;

    /*设置整个容器在浏览器中水平居中*/
}

dl {
    display: block;
    margin-block-start: 1em;
    margin-block-end: 1em;
    margin-inline-start: 0px;
    margin-inline-end: 0px;
    margin-top: 0;
    margin-bottom: 20px;
}

dt {
    float: left;
    width: 120px;
    overflow: hidden;
    clear: left;
    text-align: right;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 1.42857143;
    font-weight: 700;
    display: block;
}

dd {
    margin-left: 130px;
    line-height: 1.42857143;
}
</style>

<body onload="load()">
    <div style="display: none" th:utext="${record}" id="prescription" />
    <div class="container1">
        <div id="content"></div>
    </div>
</body>
<script type="text/javascript" src="/static/assets/jquery/jquery-1.11.3.min.js"></script>
<script type="text/javascript">
var record;

function load() {
    var dom = document.getElementById("prescription");
    record = JSON.parse(dom.textContent);
    record.targetCondition = JSON.parse(record.targetCondition);

    if (record.correctPrescription) {
        record.prescription = JSON.parse(record.correctPrescription);
    } else {
        record.prescription = JSON.parse(record.prescription);
        if (record.prescription) {
            for (var i = 0; i < record.prescription.length; i++) {
                record.prescription[i].suggest = parseEvaluateContent(record.prescription[i]);
            }
        }
    }

    record.message = record.message ? JSON.parse(record.message) : null;

    var target = record.targetCondition;
    if (target) {
        target.sex = target.sex === 1 ? '男' : (target.sex === 0 ? '女' : '')
        target.birthday = target.birthday ? dateFormat(target.birthday * 1) : ''
    } else {
        target = {};
    }

    record.createTime = record.createTime ? dateFormat(record.createTime * 1) : ''
    $("#content").html(createDivHtml());
}

function createTableHtml() {
    var target = record.targetCondition;
    var html = '<table><tr>' +
        '    <td width="120px;">姓名</td>' +
        '    <td width="415px">' + (target.name || '') + '</td>' +
        '    <td width="120px;">性别</td>' +
        '    <td width="415px">' + (target.sex || '') + '</td>' +
        '</tr>' +
        '<tr>' +
        '    <td>确认医生</td>' +
         '   <td><input id="cellphone" value="' + (target.cellphone || '') + '"/></td>' +
        '    <td>医生姓名</td>' +
        '    <td><input id="confirmer" value="' + (record.doctorName || '') + '"/></td>' +
        '</tr>';
    html += createEvaluateHtml(record.prescription);
    html += "</table>";
    return html;
}

function createEvaluateHtml(data) {
    var html = "";
    if (data) {
        for (var i = 0; i < data.length; i++) {
            html += '<tr><td>' + data[i].name + '</br><b>(' + data[i].riskLevelName + ')</b>' + '</td><td colspan="3" style="text-align:left"><pre>' + data[i].suggest + '</pre></td></tr>';
        }
    }
    return html;
}

function parseEvaluateContent(data) {
    var content = data.suggest;

    if (data.code == 'hypertension' || data.code == 'osteoporosis') {
        content = content.replace(/(2\. *运动：|3\. *吸烟：|4\. *饮酒：|5\. *心理：)/g, "@#$1");
    }

    var arr = content.split('@#');
    var ps = [];

    for (var i = 0; i < arr.length; i++) {
        var a = arr[i];
        a = $.trim(a);
        if (a && a.length > 0 && a !== '3.吸烟：') {
            ps.push(a);
        }
    }

    var s = "";
    for (var i = 0; i < ps.length; i++) {
        s += "\t" + ps[i] + "\n";
    }
    return s;
}


function createDivHtml() {

    var target = record.targetCondition;
    var html = '<div class="container2"><h3 style="text-align: center;">健康风险评估</h3>';
    html += '<div style="height: 40px;text-align: center;">' +
        '    <span style="width:100px;display: inline-block;">姓名：' + (target.name || '') + '</span>' +
        '    <span style="width:80px;display: inline-block;">性别：' + (target.sex || '') + '</span>' +
        '    <span style="width:150px;display: inline-block;">确认医生：' + (record.doctorName || '') + '</span>' +
        '    <span style="width:150px;display: inline-block;">评估时间：' + (record.createTime || '') + '</span>' +
        '</div>';

    html += createDivEvaluateHtml(record.prescription);
    html += '</div>';

    return html;
}

function createDivEvaluateHtml(data) {
    var html = "";
    if (data) {
        for (var i = 0; i < data.length; i++) {
            var item = data[i];
            html += '<dl>' +
                ' <dt>评估内容：</dt>' +
                ' <dd>' + item.name + '</dd>' +
                ' <dt>风险等级：</dt>' +
                ' <dd>' + item.riskLevelName + '</dd>' +
                ' <dt>分析建议：</dt>' +
                ' <dd><pre>' + item.suggest + '</pre>' +
                ' </dd>' +
                '</dl>';
        }
    }
    return html;
}

function dateFormat(longTypeDate) {
    var dateTypeDate = "";
    var date = new Date();
    date.setTime(longTypeDate);
    dateTypeDate += date.getFullYear(); //年    
    dateTypeDate += "-" + getMonth(date); //月     
    dateTypeDate += "-" + getDay(date); //日    
    return dateTypeDate;
}

function getMonth(date) {
    var month = "";
    month = date.getMonth() + 1; //getMonth()得到的月份是0-11    
    if (month < 10) {
        month = "0" + month;
    }
    return month;
}

function getDay(date) {
    var day = "";
    day = date.getDate();
    if (day < 10) {
        day = "0" + day;
    }
    return day;
}
</script>

</html>